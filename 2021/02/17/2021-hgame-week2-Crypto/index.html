<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 2021-hgame-week2-Crypto · H-Lither</title><meta name="description" content="2021-hgame-week2-Crypto - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="H-Lither"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="H-Lither" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">2021-hgame-week2-Crypto</h1><div class="post-info">Feb 17, 2021</div><div class="post-content"><p>-</p>
<h1 id="1-signin"><a href="#1-signin" class="headerlink" title="1.signin"></a>1.signin</h1><h2 id="Challenge"><a href="#Challenge" class="headerlink" title="Challenge"></a>Challenge</h2><blockquote>
<p>描述 签到题 233</p>
<p>题目地址 </p>
<p><a target="_blank" rel="noopener" href="https://uploader.shimo.im/f/koY9hA7C3QhHZx18.py?attname=task%20(9).py&download">附件</a></p>
<p>基准分数 150</p>
<p>当前分数 150</p>
<p>完成人数 83</p>
</blockquote>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210224033622881.png" alt="image-20210224033622881"></p>
<h3 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h3><p>费马小定理+模运算+模逆运算<br>$$<br>\because a^{p}\equiv a mod p<br>$$</p>
<p>$$<br>\therefore c\equiv (a^{p}*m) mod p\equiv (ab) modp<br>$$</p>
<p>$$<br>\therefore m\equiv c*a^{-1} mod p<br>$$</p>
<h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse,long_to_bytes</span><br><span class="line">d=inverse(a,p)</span><br><span class="line">m=c*d%p</span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"><span class="comment">#b&#x27;hgame&#123;M0du1@r_m4th+1s^th3~ba5is-Of=cRypt0!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="Getflag"><a href="#Getflag" class="headerlink" title="Getflag"></a>Getflag</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;M0du1@r_m4th+1s^th3~ba5is-Of&#x3D;cRypt0!!&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2-gcd-or-more"><a href="#2-gcd-or-more" class="headerlink" title="2.gcd or more?"></a>2.gcd or more?</h1><h2 id="Challenge-1"><a href="#Challenge-1" class="headerlink" title="Challenge"></a>Challenge</h2><blockquote>
<p>描述</p>
<p>GCD…?</p>
<p>题目地址 </p>
<p><a target="_blank" rel="noopener" href="https://uploader.shimo.im/f/RgIgZh0F0O2DDBmO.py?attname=task%20(10).py&download">附件</a></p>
<p>基准分数 200</p>
<p>当前分数 200</p>
<p>完成人数 91</p>
</blockquote>
<h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210224035200644.png" alt="image-20210224035200644"></p>
<p>思路：</p>
<p>看到e=2，且已知p,q猜测 为RSA 的<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5113">rabin</a>的加密算法</p>
<h3 id="推导："><a href="#推导：" class="headerlink" title="推导："></a>推导：</h3><h4 id="加密过程："><a href="#加密过程：" class="headerlink" title="加密过程："></a>加密过程：</h4><p>选择两个大素数p和q做为私钥</p>
<p>计算n = p * q做为公钥</p>
<p>若明文为m，则密文为<br>$$<br>c ≡ m^2 (mod n)<br>$$</p>
<h4 id="解密过程："><a href="#解密过程：" class="headerlink" title="解密过程："></a>解密过程：</h4><p>$$<br>r\equiv \sqrt{c} (mod p)<br>$$</p>
<p>$$<br>s\equiv \sqrt{c} (mod q)<br>$$</p>
<p>根据欧拉判别式，满足p为素数，gcd(c,p)=1</p>
<p>则有<br>$$<br>a^{(p-1)/2}\equiv 1 modp<br>$$</p>
<p>$$<br>\because r^{2} \equiv c mod p<br>$$</p>
<p>$$<br>\therefore r^{2}\equiv c  c^{(p-1)/2}modp \equiv c^{(p+1)/2}mod p \equiv (c^{(p+1)/4})^{2}modp<br>$$</p>
<p>$$<br>\therefore r \equiv (c^{(p+1)/4})modp<br>$$</p>
<p>$$<br>s \equiv  (c^{(q+1)/4})modq<br>$$</p>
<p>根据扩展欧几里得算法：<br>$$<br>ap + bq ≡ 1 (mod n)<br>$$</p>
<p>$$<br>a=p^{-1} (mod q)，b=q^{-1} (mod p)<br>$$</p>
<p>$$<br>x_{1}=(aps+bqr)mod n<br>$$</p>
<p>$$<br>x2=n-x_{1}<br>$$</p>
<p>$$<br>x3=(aps-bqr)mod n<br>$$</p>
<p>$$<br>x4=n-x_{3}<br>$$</p>
<h3 id="脚本："><a href="#脚本：" class="headerlink" title="脚本："></a>脚本：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">85228565021128901853314934583129083441989045225022541298550570449389839609019</span></span><br><span class="line">q = <span class="number">111614714641364911312915294479850549131835378046002423977989457843071188836271</span></span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">c=<span class="number">7665003682830666456193894491015989641647854826647177873141984107202099081475984827806007287830472899616818080907276606744467453445908923054975393623509539</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_decrypt</span>(<span class="params">c, p, q, e=<span class="number">2</span></span>):</span></span><br><span class="line">    n = p * q</span><br><span class="line">    mp = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    mq = <span class="built_in">pow</span>(c, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">    yp = gmpy2.invert(p, q)</span><br><span class="line">    yq = gmpy2.invert(q, p)</span><br><span class="line">    r = (yp * p * mq + yq * q * mp) % n</span><br><span class="line">    rr = n - r</span><br><span class="line">    s = (yp * p * mq - yq * q * mp) % n</span><br><span class="line">    ss = n - s</span><br><span class="line">    <span class="keyword">return</span> (r, rr, s, ss)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = rabin_decrypt(c, p, q)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m[i])[<span class="number">2</span>:]))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#b&#x27;z\x95\x82\x00R3\x1d\x11\xb3\x02Q\xb8\x1f\xcd\xe0\xd0\xbeC\xc31%\xa8]* \t\xdb\xf1v\x87O\xf9 \x15\xbc\xcc+\xe0\xebf\xc4\xd4k\nJ\xfbN\x03\\\xcc\x7f\x00\xa9\x90\xd8l\xef\x98\xce^\xd3\xbd72&#x27;</span></span><br><span class="line"><span class="comment">#b&#x27;;\x0b\xe7ra \x82\x1fXQ/\xa1V.\xb9\x91\xc2\xd1&#123;\x9d\xe4;n\x9f\xbb\xd7\xeb\x15\xa8\xc6b\x1e\xb0d\x04^\x000\x0f\xa8\x9a\xfe\xa4\x05|\x9d\xa4&#125;s\x05z\x94\xe9\x80\xda=97R\x00?6A\xa3&#x27;</span></span><br><span class="line"><span class="comment">#b&#x27;\xb5\xa1ir\xb3S\x9f1\x0bS\x81Yu\xfc\x9ab\x81\x15&gt;\xcf\t\xe3\xcb\xc9\xdb\xe1\xc7\x07\x1fMI\xb0o\x0c[\xae\xf8\x98\x93\xcb\xfbT\xa5\xdah&amp;\x8dLc\xa0\x80j-\xd1?0\xca]\xee\xf7\xaa\x7f9X&#x27;</span></span><br><span class="line"><span class="comment">#b&#x27;hgame&#123;3xgCd~i5_re4l1y+e@sy^r1ght?&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="Getflag-1"><a href="#Getflag-1" class="headerlink" title="Getflag"></a>Getflag</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;3xgCd~i5_re4l1y+e@sy^r1ght?&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-WhitegiveRSA"><a href="#3-WhitegiveRSA" class="headerlink" title="3.WhitegiveRSA"></a>3.WhitegiveRSA</h1><p><del>手速快拿了一血hhh</del></p>
<h2 id="Challenge-2"><a href="#Challenge-2" class="headerlink" title="Challenge"></a>Challenge</h2><blockquote>
<p>描述</p>
<p>N = 882564595536224140639625987659416029426239230804614613279163<br>e = 65537<br>c = 747831491353896780365654517748216624798517769637260742155527</p>
<p>题目地址 </p>
<p><a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a></p>
<p>基准分数 150</p>
<p>当前分数 150</p>
<p>完成人数 187</p>
</blockquote>
<h2 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h2><h3 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N &#x3D; 882564595536224140639625987659416029426239230804614613279163</span><br><span class="line">e &#x3D; 65537</span><br><span class="line">c &#x3D; 747831491353896780365654517748216624798517769637260742155527</span><br></pre></td></tr></table></figure>
<p>通过<a target="_blank" rel="noopener" href="http://www.factordb.com/">在线网站</a>将N分解为p,q，算出欧拉值，求逆元。</p>
<h3 id="脚本：-1"><a href="#脚本：-1" class="headerlink" title="脚本："></a>脚本：</h3><p>教科书般的脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">882564595536224140639625987659416029426239230804614613279163</span></span><br><span class="line">p=<span class="number">857504083339712752489993810777</span></span><br><span class="line">q=<span class="number">1029224947942998075080348647219</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N=p*q</span><br><span class="line">c = <span class="number">747831491353896780365654517748216624798517769637260742155527</span></span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)<span class="comment">#计算欧拉值</span></span><br><span class="line">d=invert(e,phi)<span class="comment">#求逆元</span></span><br><span class="line">m=<span class="built_in">pow</span>(c,d,N)</span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"><span class="comment">#hgame&#123;w0w~yOU_kNoW+R5@!&#125;</span></span><br></pre></td></tr></table></figure>
<p>Getflag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#hgame&#123;w0w~yOU_kNoW+R5@!&#125;</span><br></pre></td></tr></table></figure>
<h1 id="4-The-Password"><a href="#4-The-Password" class="headerlink" title="4.The Password"></a>4.The Password</h1><h2 id="Challenge-3"><a href="#Challenge-3" class="headerlink" title="Challenge"></a>Challenge</h2><blockquote>
<p>描述</p>
<p>Hint</p>
<p>题目地址 </p>
<p><a target="_blank" rel="noopener" href="https://uploader.shimo.im/f/Y1dSX4zx6JTyjGUa.txt?attname=flag.txt&download">附件</a></p>
<p>基准分数 250</p>
<p>当前分数 250</p>
<p>完成人数 40</p>
</blockquote>
<h2 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h2><h3 id="题目描述-3"><a href="#题目描述-3" class="headerlink" title="题目描述"></a>题目描述</h3><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210224045847254.png" alt="image-20210224045847254"></p>
<h3 id="脚本-1"><a href="#脚本-1" class="headerlink" title="脚本"></a>脚本</h3><p>注意位数，利用Z3一把梭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rol</span>(<span class="params">x,n</span>):</span></span><br><span class="line">    <span class="comment">#bits = len(bin(x)[2:])</span></span><br><span class="line">    bits=<span class="number">64</span></span><br><span class="line">    res = (x&lt;&lt;n | x&gt;&gt;(bits-n)) % <span class="built_in">pow</span>(<span class="number">2</span>,bits)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ror</span>(<span class="params">x,n</span>):</span></span><br><span class="line">    <span class="comment">#bits = len(bin(x)[2:])</span></span><br><span class="line">    bits=<span class="number">64</span></span><br><span class="line">    res = (x&gt;&gt;n | x&lt;&lt;(bits-n)) % <span class="built_in">pow</span>(<span class="number">2</span>,bits)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s= Solver()</span><br><span class="line">x = BitVec(<span class="string">&#x27;x1&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">n = <span class="number">10750832281632461</span></span><br><span class="line">y = <span class="number">4622436850708129231</span></span><br><span class="line">s.add(y==x^n^ror(x,<span class="number">2</span>)^rol(x,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">if</span>(s.check()==sat):</span><br><span class="line">    print(s.model())</span><br><span class="line">print(long_to_bytes(<span class="number">28541</span>))</span><br><span class="line"><span class="comment">#hgame&#123;l1ne0r_a1gebr0&amp;is@1mpor10n1^1n$crypto&#125;</span></span><br><span class="line"><span class="comment"># is@1mpo</span></span><br></pre></td></tr></table></figure>
<p>Getflag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;l1ne0r_a1gebr0&amp;is@1mpor10n1^1n$crypto&#125;</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2021/02/17/2021-hgame-week3-Crypto/" class="prev">PREV</a><a href="/2021/02/17/%E5%88%B7%E9%A2%98%E7%AF%87-%E4%B8%89-Cryptohack-RSA/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2021 <a href="http://example.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>