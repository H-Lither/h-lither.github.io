<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Crypto-DSA&ECDSA · H-Lither</title><meta name="description" content="Crypto-DSA&amp;ECDSA - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="H-Lither"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="H-Lither" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Crypto-DSA&ECDSA</h1><div class="post-info">Feb 23, 2021</div><div class="post-content"><p>-</p>
<h1 id="DSA"><a href="#DSA" class="headerlink" title="DSA"></a>DSA</h1><h2 id="DSA签名过程："><a href="#DSA签名过程：" class="headerlink" title="DSA签名过程："></a>DSA签名过程：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210223043552604.png" alt="image-20210223043552604"></p>
<h2 id="签名验证及原理："><a href="#签名验证及原理：" class="headerlink" title="签名验证及原理："></a>签名验证及原理：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210223043713543.png" alt="image-20210223043713543"></p>
<h2 id="DSA攻击方式："><a href="#DSA攻击方式：" class="headerlink" title="DSA攻击方式："></a>DSA攻击方式：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210223043722223.png" alt="image-20210223043722223"></p>
<h1 id="ECDSA"><a href="#ECDSA" class="headerlink" title="ECDSA"></a>ECDSA</h1><h2 id="ECDSA签名过程："><a href="#ECDSA签名过程：" class="headerlink" title="ECDSA签名过程："></a>ECDSA签名过程：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210223043759652.png" alt="image-20210223043759652"></p>
<h2 id="ECDSA验签即原理："><a href="#ECDSA验签即原理：" class="headerlink" title="ECDSA验签即原理："></a>ECDSA验签即原理：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210223043832576.png" alt="image-20210223043832576"></p>
<h2 id="ECDSA攻击方式："><a href="#ECDSA攻击方式：" class="headerlink" title="ECDSA攻击方式："></a>ECDSA攻击方式：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210223043436542.png" alt="image-20210223043436542"></p>
<h1 id="例题："><a href="#例题：" class="headerlink" title="例题："></a>例题：</h1><h2 id="DSA–SUCTF-2019-DSA"><a href="#DSA–SUCTF-2019-DSA" class="headerlink" title="DSA–SUCTF 2019  DSA"></a>DSA–SUCTF 2019  DSA</h2><p>(没找到题目，只有一篇WP，里面包含了题目的值)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> DSA</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.asymmetric.rsa <span class="keyword">import</span> _modinv</span><br><span class="line"></span><br><span class="line">p = <span class="number">89884656743115795580686663829063433723705316331915518116995555215732107995059028542508401244839154951727540560161931978595376162965578570688594466436802284147607626105578924348149452183916543288346766737451989059750506942292767656446346135964708979885460659773076011464167414551120634816058711585048191954497</span></span><br><span class="line">q = <span class="number">1111804377363103506497255080558092668997313464491</span></span><br><span class="line">g = <span class="number">81015871603456981032885262867256289415428185718067221863176015480426278916784273932461088597278453025238130171264554340337052290801398971212149002598733514497274080038687844873045392142055341888546884513467006243654622193996237786587933291936305860861104505778330178660321910982065964185311229731036440300912</span></span><br><span class="line">y = <span class="number">24205967076065946398939942966555243225474145978138314135133201932616151998778053968114291774217862261420967723355996662814191035892360634754604901035581578539634376520187757713469318847622699231634156440729178396025399617453913697005440949117064991219553520585024955478025227096450962672242862991836900979588</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#找到一组同r的数据，m为字符串的md5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># And see the brave day sunk in hideous night</span></span><br><span class="line"><span class="comment"># Its MD5 digest: 189275664133327295485034625257633857845</span></span><br><span class="line"><span class="comment"># (1110285731834476772119910400331516120389395795749L, 671563422243860980520073471433161684440141852624L)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># And sable curls all silver&#x27;d o&#x27;er with white</span></span><br><span class="line"><span class="comment"># Its MD5 digest: 76447611971473350019028042637993930502</span></span><br><span class="line"><span class="comment"># (1110285731834476772119910400331516120389395795749L, 218895397309026853341136197466419726836220239272L)</span></span><br><span class="line"></span><br><span class="line">s0=<span class="number">671563422243860980520073471433161684440141852624</span></span><br><span class="line">s1=<span class="number">218895397309026853341136197466419726836220239272</span></span><br><span class="line"></span><br><span class="line">m0=<span class="number">189275664133327295485034625257633857845</span></span><br><span class="line">m1=<span class="number">76447611971473350019028042637993930502</span></span><br><span class="line"></span><br><span class="line">r= <span class="number">1110285731834476772119910400331516120389395795749</span></span><br><span class="line"></span><br><span class="line">dm=m1-m0</span><br><span class="line">ds=s1-s0</span><br><span class="line"></span><br><span class="line">k = gmpy2.mul(dm, gmpy2.invert(ds, q))</span><br><span class="line">k = gmpy2.f_mod(k, q)</span><br><span class="line">tmp = gmpy2.mul(k, s0) - m0</span><br><span class="line">x = tmp * gmpy2.invert(r, q)</span><br><span class="line">x = gmpy2.f_mod(x, q)</span><br><span class="line"></span><br><span class="line">data5=<span class="string">&quot;&quot;&quot;And nothing &#x27;gainst Time&#x27;s scythe can make defence&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">kinv = _modinv(k, q)</span><br><span class="line">h = hashlib.md5(data5.encode()).digest()</span><br><span class="line">h = <span class="built_in">int</span>.from_bytes(h, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">s = kinv * (h + r * x) % q</span><br><span class="line">print(<span class="string">&quot;(&quot;</span>+<span class="built_in">str</span>(r)+<span class="string">&quot;L, &quot;</span>+<span class="built_in">str</span>(<span class="built_in">int</span>(s))+<span class="string">&quot;L)&quot;</span>)</span><br><span class="line"><span class="comment">#flag：flag&#123;Wh4t_a_Prety_Si3nature!&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="ECDSA—CTF-show-F5杯-Crypto-soezecdsa"><a href="#ECDSA—CTF-show-F5杯-Crypto-soezecdsa" class="headerlink" title="ECDSA—CTF.show (F5杯-Crypto-soezecdsa)"></a>ECDSA—CTF.show (F5杯-Crypto-soezecdsa)</h2><p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ecdsa</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">k</span>):</span></span><br><span class="line">	<span class="keyword">return</span> k + <span class="built_in">chr</span>(<span class="number">16</span> - <span class="built_in">len</span>(k) % <span class="number">16</span>) * (<span class="number">16</span> - <span class="built_in">len</span>(k) % <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">g = ecdsa.NIST256p.generator</span><br><span class="line"><span class="built_in">ord</span> = g.order()</span><br><span class="line">ss = random.randrange(<span class="number">1</span>, <span class="built_in">ord</span>)</span><br><span class="line"></span><br><span class="line">pub = ecdsa.ecdsa.Public_key(g, g * ss)</span><br><span class="line">priv = ecdsa.ecdsa.Private_key(pub, ss)</span><br><span class="line"> </span><br><span class="line">n = random.randrange(<span class="number">1</span>, <span class="number">2</span> ** <span class="number">127</span>)</span><br><span class="line"></span><br><span class="line">h1 = random.randrange(<span class="number">1</span>, <span class="built_in">ord</span>)</span><br><span class="line">h2 = random.randrange(<span class="number">1</span>, <span class="built_in">ord</span>)</span><br><span class="line">s1 = priv.sign(h1, n)</span><br><span class="line">s2 = priv.sign(h2, n)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(ss.to_bytes(<span class="number">64</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)[<span class="number">0</span>:<span class="number">16</span>], AES.MODE_CBC, <span class="string">b&#x27;\0&#x27;</span> * <span class="number">16</span>)</span><br><span class="line">c = cipher.encrypt(pad(<span class="string">&quot;ctfshow&#123;F_5_F_5_F_5_F_5_F_5_F_5_F_5_F_5_F_5_F_5&#125;&quot;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">print(s1.r)</span><br><span class="line">print((s1.s, s2.s))</span><br><span class="line">print((h1, h2))</span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#60963656919952335330699495914604076133088545196341270906012199546992023482470</span></span><br><span class="line"><span class="comment">#(73717183989655107551694042301768298629060759808504642594624975900023461782627, 14687661690747284846117782855464712425538068387758686204509438427659320546252)</span></span><br><span class="line"><span class="comment">#(78282427923826024273891589234109005052482119099079121663545750577095212333215, 95633252274852616927283591980907278832230595718028531805745075047977731184020)</span></span><br><span class="line"><span class="comment">#28ff889a4bf476378f0dd924e1c8ccdd78aba055bf3f24e617a558c8333d4e283ed54186576f50c24fe3109823ade497</span></span><br></pre></td></tr></table></figure>


<p>NIST256p是一个ECC推荐参数。也就是给定曲线，n已知。</p>
<p>且用相同的K签名。</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">r=<span class="number">60963656919952335330699495914604076133088545196341270906012199546992023482470</span></span><br><span class="line">s1=<span class="number">73717183989655107551694042301768298629060759808504642594624975900023461782627</span></span><br><span class="line">s2=<span class="number">14687661690747284846117782855464712425538068387758686204509438427659320546252</span></span><br><span class="line">h1=<span class="number">78282427923826024273891589234109005052482119099079121663545750577095212333215</span></span><br><span class="line">h2=<span class="number">95633252274852616927283591980907278832230595718028531805745075047977731184020</span></span><br><span class="line">c=<span class="number">0x28ff889a4bf476378f0dd924e1c8ccdd78aba055bf3f24e617a558c8333d4e283ed54186576f50c24fe3109823ade497</span></span><br><span class="line">n=<span class="number">115792089210356248762697446949407573529996955224135760342422259061068512044369</span></span><br><span class="line">k=(invert((s1-s2),n)*(h1-h2))%n</span><br><span class="line">print(k)</span><br><span class="line">d=<span class="number">37791682356041176430586914331338157883737680803292173075282962428996323272403</span></span><br><span class="line">print(d)</span><br><span class="line">key=d.to_bytes(<span class="number">64</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">print(key)</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, <span class="string">b&#x27;\0&#x27;</span> * <span class="number">16</span>)</span><br><span class="line">n= cipher.decrypt(long_to_bytes(c))</span><br><span class="line">print(n)</span><br><span class="line"><span class="comment">#73092245794933305962848542028152783930</span></span><br><span class="line"><span class="comment">#37791682356041176430586914331338157883737680803292173075282962428996323272403</span></span><br><span class="line"><span class="string">b&#x27;\xd3fjy\xe6\x9d^\xa9?\xe4\xd1\xa6\x8f\x0f\x9e\xf2&#x27;</span></span><br><span class="line"><span class="string">b&#x27;ctfshow&#123;F5_cAn_S0lv3_8AsIC_3CDsA_pr08L3M&#125;\x07\x07\x07\x07\x07\x07\x07&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<p>引用：</p>
<p><a target="_blank" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2454225341&amp;site=qq&amp;menu=yes">http://wpa.qq.com/msgrd?v=3&amp;uin=2454225341&amp;site=qq&amp;menu=yes</a></p>
<p><a target="_blank" rel="noopener" href="https://ohmygodlin.github.io/ctf/crypto/2019/03/28/DSA%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/">https://ohmygodlin.github.io/ctf/crypto/2019/03/28/DSA%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2021/02/24/Crypto-RSA/" class="prev">PREV</a><a href="/2021/02/22/0xgame2020-Rev-%E5%A4%8D%E7%8E%B0/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2021 <a href="http://example.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>