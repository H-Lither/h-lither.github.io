<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Crypto-LCG · H-Lither</title><meta name="description" content="Crypto-LCG - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="H-Lither"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="H-Lither" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Crypto-LCG</h1><div class="post-info">Jan 28, 2021</div><div class="post-content"><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="起因："><a href="#起因：" class="headerlink" title="起因："></a>起因：</h2><p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210127222647337.png" alt="image-20210127222647337"></p>
<p>之前师兄让我学LCG，自己也想补充一下这方面的内容，但因为当时期末考试+※CTF+冬令营+回家摸了一天鱼（不是，是休息了一天<em>(:з」∠)\</em>)耽误到今天。</p>
<h2 id="前置知识："><a href="#前置知识：" class="headerlink" title="前置知识："></a>前置知识：</h2><h3 id="1-随机数"><a href="#1-随机数" class="headerlink" title="1.随机数"></a>1.随机数</h3><p>随机数在密码技术中扮演着十分重要的角色。</p>
<h4 id="随机数应用："><a href="#随机数应用：" class="headerlink" title="随机数应用："></a>随机数应用：</h4><p>用到随机数的场景：</p>
<ul>
<li><p>生成密钥</p>
<p>用于对称密码和消息认证</p>
</li>
<li><p>生成密钥对</p>
<p>用于公钥密码和数字签名</p>
</li>
<li><p>生成初始化向量</p>
<p>用于分组密码的CBC、CFB和OFB模式</p>
</li>
<li><p>生成nonce</p>
<p>用于防御重放攻击以及分组密码的CTR模式等</p>
</li>
<li><p>生成salt</p>
<p>用于基于口令的密码（PBE）</p>
</li>
</ul>
<h4 id="随机数性质："><a href="#随机数性质：" class="headerlink" title="随机数性质："></a>随机数性质：</h4><ul>
<li><p>随机性（弱伪随机数）</p>
<p>一堆杂乱无章的数（能被看穿）</p>
</li>
<li><p>不可预测性（强伪随机数）</p>
<p>在知道过去生成的伪随机数列的前提下，依然无法预测出下一个生成的伪随机数。</p>
<p>其中，不可预测性是使用其他的密码技术来实现的，如sha-1</p>
</li>
<li><p>不可重现性（真随机数）</p>
<p>在理论下，使用计算机软件生成的数列，在某个时刻一定会出现重复，这个时间或长或短，由于计算机的内存是有限，这个时刻肯定会出现。所以软件生成的数列，肯定是具有周期性（会重复出现），所以不具备该性质。由硬件生成的数列，一般则具有该性质。 </p>
</li>
</ul>
<p>由硬件生成的随机数列，根据传感器收集的热量、声音的变化等事实上无法预测的和重现自然现象信息来生成的，像这样的硬件设备，称为随机数生成器。</p>
<p>而LCG就是一个伪随机数生成器。之所以称为伪随机数生成器，是由于它是由软件生成的。</p>
<h3 id="2-模运算"><a href="#2-模运算" class="headerlink" title="2.模运算"></a>2.模运算</h3><p>模运算，就是一个取余运算。如 23 mod 7 = 2 ， 可以写成  23%7=2.</p>
<p>一些性质：</p>
<p> (a + b) % p = (a % p + b % p) % p<br>(a - b) % p = (a % p - b % p) % p<br>(a * b) % p = (a % p * b % p) % p<br>(a ^ b) % p = ((a % p) ^ b ) % p<br>模运算的结合律：<br>((a + b) % p + c) % p= (a + (b + c) % p) % p<br>((a * b) % p * c) % p = (a * (b * c) % p ) % p<br>交换律：<br>(a + b) % p = (b+a) % p<br>(a * b) % p = (b * a) % p<br>分配律：<br>((a +b) % p * c) % p = ((a * c) % p + (b * c) % p) % p</p>
<h3 id="3-模逆运算"><a href="#3-模逆运算" class="headerlink" title="3.模逆运算"></a>3.模逆运算</h3><p>逆元是指指数学领域群G中任意一个元a，都在G中有唯一的逆元a‘,具有性质a×a’=a’×a=e，其中e为该群的单位元。在模运算中，e=1。</p>
<p><strong>第一种方法是循环求解法</strong></p>
<p><strong>第二种方法是扩展欧几里得算法</strong>：欧几里得算法的依据是最大公约数定理：对任意的非负整数a和任意正整数b，gcd(a,b) = gcd(b,a mod b).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#逆元计算</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>第三种方法是调用库：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">d&#x3D;gmpy2.invert(a,b)#gmpy2库</span><br><span class="line"></span><br><span class="line">from Crypto.Util.number import inverse</span><br><span class="line">d&#x3D;inverse(a,b)#Crypto库</span><br></pre></td></tr></table></figure>
<p>​    </p>
<h2 id="LCG-线性同余法"><a href="#LCG-线性同余法" class="headerlink" title="LCG:线性同余法"></a>LCG:线性同余法</h2><h3 id="简单的介绍："><a href="#简单的介绍：" class="headerlink" title="简单的介绍："></a>简单的介绍：</h3><p>表达式： <img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128003510667.png" alt="image-20210128003510667"></p>
<p>组成的线性同余发生器：</p>
<p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128004034938.png" alt="image-20210128004034938"></p>
<p>a对b取模</p>
<p>其中xn是seed.</p>
<p>a,b,m是设定的常量。</p>
<p>结合图和表达式可知，就是把种子传入发生器中，乘上a再加上c然后对m取模得到第一个伪随机数，然后返回到发生器中作为seed，在进行上一步的操作得到第二个，然后再传入发生器中。</p>
<p>举个例子：假设 a=3 b=0,m=7,seed=6</p>
<p>R1=(a<em>seed+b)mod m=(3\</em>6+0) mod 7 = 4</p>
<p>R2=(a<em>seed+b)mod m=(3\</em>4+0) mod 7  = 5</p>
<p>R3=(a<em>seed+b)mod m=(3\</em>5+0) mod 7  = 1</p>
<p>R4=(a<em>seed+b)mod m=(3\</em>1+0) mod 7  = 3</p>
<p>R5=(a<em>seed+b)mod m=(3\</em>3+0) mod 7  = 2</p>
<p>R6=(a<em>seed+b)mod m=(3\</em>2+0) mod 7  = 6</p>
<p>R7=(a<em>seed+b)mod m=(3\</em>6+0) mod 7  = 4</p>
<p>同时也可以发现，伪随机数是对m取模后的值，其范围为 0~m-1，也就是 其周期。</p>
<p>同时也证明了其不具备不可预测性。所以线性同余法得到的是弱伪随机数。</p>
<h3 id="攻击手段："><a href="#攻击手段：" class="headerlink" title="攻击手段："></a>攻击手段：<img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128005426302.png" alt="image-20210128005426302"></h3><p>上图的变形都是基于原始表达式变形的。</p>
<p>1：<strong>Xn+1 = aXn + b (mod m)<br>      aXn = Xn+1 - b (mod m)<br>      Xn = a` (Xn+1 - b) (mod m)</strong></p>
<p>2：<strong>Xn+2 = aXn+1 + b (mod m)<br>Xn+1 = aXn + b (mod m)<br>Xn+2 - Xn+1 = a(Xn+1-Xn) (mod m)<br>a = (Xn+2 - Xn+1)(Xn+1 - Xn)-1 (mod m)</strong></p>
<p>3：<strong>Xn+1 = aXn + b (mod m)<br>b = Xn+1 - aXn (mod m)</strong></p>
<p>4：<img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128005851844.png" alt="image-20210128005851844"></p>
<h3 id="题目复现："><a href="#题目复现：" class="headerlink" title="题目复现："></a>题目复现：</h3><h4 id="1-LCG1："><a href="#1-LCG1：" class="headerlink" title="1.LCG1："></a>1.LCG1：</h4><p>题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;***********************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = <span class="number">33477128523140105764301644224721378964069</span></span><br><span class="line">print(<span class="string">&quot;seed = &quot;</span>,seed)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">ciphertext = seed^plaintext</span><br><span class="line">print(<span class="string">&quot;a = &quot;</span>,a)</span><br><span class="line">print(<span class="string">&quot;b = &quot;</span>,b)</span><br><span class="line">print(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line">print(<span class="string">&quot;c = &quot;</span>,ciphertext)</span><br><span class="line"><span class="comment"># seed =  33477128523140105764301644224721378964069</span></span><br><span class="line"><span class="comment"># a =  216636540518719887613942270143367229109002078444183475587474655399326769391</span></span><br><span class="line"><span class="comment"># b =  186914533399403414430047931765983818420963789311681346652500920904075344361</span></span><br><span class="line"><span class="comment"># n =  155908129777160236018105193822448288416284495517789603884888599242193844951</span></span><br><span class="line"><span class="comment"># c =  209481865531297761516458182436122824479565806914713408748457524641378381493</span></span><br></pre></td></tr></table></figure>
<p>由题可知，plaintext是flag转整数得到。而其与线性同余产生的10个伪随机逐个进行了异或。所以解密也很简单。求出10个伪随机数，异或回去即可。</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">seed = <span class="number">33477128523140105764301644224721378964069</span></span><br><span class="line">a = <span class="number">216636540518719887613942270143367229109002078444183475587474655399326769391</span></span><br><span class="line">b = <span class="number">186914533399403414430047931765983818420963789311681346652500920904075344361</span></span><br><span class="line">n = <span class="number">155908129777160236018105193822448288416284495517789603884888599242193844951</span></span><br><span class="line">c = <span class="number">209481865531297761516458182436122824479565806914713408748457524641378381493</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">plaintext=seed^c</span><br><span class="line">print(long_to_bytes(plaintext))</span><br><span class="line"><span class="comment">#Spirit&#123;0ops!___you_know__LCG!!&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-LCG2"><a href="#2-LCG2" class="headerlink" title="2.LCG2:"></a>2.LCG2:</h4><p>题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;*****************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">ciphertext = seed</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;a = &quot;</span>,a)</span><br><span class="line">print(<span class="string">&quot;b = &quot;</span>,b)</span><br><span class="line">print(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line">print(<span class="string">&quot;c = &quot;</span>,ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a =  59398519837969938359106832224056187683937568250770488082448642852427682484407513407602969</span></span><br><span class="line"><span class="comment"># b =  32787000674666987602016858366912565306237308217749461581158833948068732710645816477126137</span></span><br><span class="line"><span class="comment"># n =  43520375935212094874930431059580037292338304730539718469760580887565958566208139467751467</span></span><br><span class="line"><span class="comment"># c =  8594514452808046357337682911504074858048299513743867887936794439125949418153561841842276</span></span><br></pre></td></tr></table></figure>
<p>由题可知，plaintext是flag转整数得到。且seed=plaintext，即初始化的seed即为我们要求出来的目标。倒过来求，先求出逆元。<img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128011747833.png" alt="image-20210128011747833"></p>
<p>脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">a =  <span class="number">59398519837969938359106832224056187683937568250770488082448642852427682484407513407602969</span></span><br><span class="line">b =  <span class="number">32787000674666987602016858366912565306237308217749461581158833948068732710645816477126137</span></span><br><span class="line">n =  <span class="number">43520375935212094874930431059580037292338304730539718469760580887565958566208139467751467</span></span><br><span class="line">c =  <span class="number">8594514452808046357337682911504074858048299513743867887936794439125949418153561841842276</span></span><br><span class="line">ani=gmpy2.invert(a,n) </span><br><span class="line">seed=c</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (ani*(seed-b))%n</span><br><span class="line">print(long_to_bytes(seed)</span><br><span class="line"><span class="comment">#Spirit&#123;Orzzz__number_the0ry_master!!&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-LCG3："><a href="#3-LCG3：" class="headerlink" title="3.LCG3："></a>3.LCG3：</h4><p>题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;*********************&#125;&#x27;</span></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">seed = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">b = plaintext</span><br><span class="line"></span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">    output.append(seed)</span><br><span class="line">ciphertext = seed</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;a = &quot;</span>,a)</span><br><span class="line">print(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line">print(<span class="string">&quot;output1 = &quot;</span>,output[<span class="number">6</span>])</span><br><span class="line">print(<span class="string">&quot;output2 = &quot;</span>,output[<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># a =  3227817955364471534349157142678648291258297398767210469734127072571531</span></span><br><span class="line"><span class="comment"># n =  2731559135349690299261470294200742325021575620377673492747570362484359</span></span><br><span class="line"><span class="comment"># output1 =  56589787378668192618096432693925935599152815634076528548991768641673</span></span><br><span class="line"><span class="comment"># output2 =  2551791066380515596393984193995180671839531603273409907026871637002460</span></span><br></pre></td></tr></table></figure>
<p>由题可知，plaintext是flag转整数得到。且b=plaintext,</p>
<p>即b未知，用已知条件求b</p>
<p>已知两个生成的伪随机数。利用3。</p>
<p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128012138869.png"></p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">3227817955364471534349157142678648291258297398767210469734127072571531</span></span><br><span class="line">n=<span class="number">2731559135349690299261470294200742325021575620377673492747570362484359</span></span><br><span class="line">output1=<span class="number">56589787378668192618096432693925935599152815634076528548991768641673</span></span><br><span class="line">output2=<span class="number">2551791066380515596393984193995180671839531603273409907026871637002460</span></span><br><span class="line">b=(output2-a*output1)%n</span><br><span class="line">plaintext=b</span><br><span class="line">print(long_to_bytes(plaintext))</span><br><span class="line"><span class="comment">#Spirit&#123;Y0u_@r3_g00d_at__math&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-LCG4"><a href="#4-LCG4" class="headerlink" title="4.LCG4:"></a>4.LCG4:</h4><p>题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;********************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = plaintext</span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">    output.append(seed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line">print(<span class="string">&quot;output = &quot;</span>,output)</span><br><span class="line"><span class="comment"># n =  714326667532888136341930300469812503108568533171958701229258381897431946521867367344505142446819</span></span><br><span class="line"><span class="comment"># output =  [683884150135567569054700309393082274015273418755015984639210872641629102776137288905334345358223, 285126221039239401347664578761309935673889193236512702131697050766454881029340147180552409870425, 276893085775448203669487661735680485319995668779836512706851431217470824660349740546793492847822, 670041467944152108349892479463033808393249475608933110640580388877206700116661070302382578388629, 122640993538161410588195475312610802051543155060328971488277224112081166784263153107636108815824, 695403107966797625391061914491496301998976621394944936827202540832952594905520247784142392337171, 108297989103402878258100342544600235524390749601427490182149765480916965811652000881230504838949, 3348901603647903020607356217291999644800579775392251732059562193080862524671584235203807354488, 632094372828241320671255647451901056399237760301503199444470380543753167478243100611604222284853, 54758061879225024125896909645034267106973514243188358677311238070832154883782028437203621709276]</span></span><br></pre></td></tr></table></figure>
<p>由题可知，plaintext是flag转整数得到。且seed=plaintext.即目标为求出seed。类似题二。但没有给出a,b，即由转化为求，a,b。</p>
<p>a用法二求，</p>
<p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128012549675.png" alt="image-20210128012549675"></p>
<p>b用法3求</p>
<p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128012557104.png" alt="image-20210128012557104"></p>
<p>再由法一，求逆元根据已知伪随机数倒推回去得到初始化的seed。</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n =  <span class="number">714326667532888136341930300469812503108568533171958701229258381897431946521867367344505142446819</span></span><br><span class="line">output =  [<span class="number">683884150135567569054700309393082274015273418755015984639210872641629102776137288905334345358223</span>, <span class="number">285126221039239401347664578761309935673889193236512702131697050766454881029340147180552409870425</span>, <span class="number">276893085775448203669487661735680485319995668779836512706851431217470824660349740546793492847822</span>, <span class="number">670041467944152108349892479463033808393249475608933110640580388877206700116661070302382578388629</span>, <span class="number">122640993538161410588195475312610802051543155060328971488277224112081166784263153107636108815824</span>, <span class="number">695403107966797625391061914491496301998976621394944936827202540832952594905520247784142392337171</span>, <span class="number">108297989103402878258100342544600235524390749601427490182149765480916965811652000881230504838949</span>, <span class="number">3348901603647903020607356217291999644800579775392251732059562193080862524671584235203807354488</span>, <span class="number">632094372828241320671255647451901056399237760301503199444470380543753167478243100611604222284853</span>, <span class="number">54758061879225024125896909645034267106973514243188358677311238070832154883782028437203621709276</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a=(output[<span class="number">2</span>]-output[<span class="number">1</span>])*gmpy2.invert((output[<span class="number">1</span>]-output[<span class="number">0</span>]),n)%n</span><br><span class="line">ani=gmpy2.invert(a,n)</span><br><span class="line">b=(output[<span class="number">1</span>]-a*output[<span class="number">0</span>])%n</span><br><span class="line">seed = (ani*(output[<span class="number">0</span>]-b))%n</span><br><span class="line">plaintext=seed</span><br><span class="line">print(long_to_bytes(plaintext))</span><br><span class="line"><span class="comment">#Spirit&#123;Gr3at__J0b!_You_can_be___better!&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-LCG5"><a href="#5-LCG5" class="headerlink" title="5.LCG5:"></a>5.LCG5:</h4><p>题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;****************************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = plaintext</span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">    output.append(seed)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;output = &quot;</span>,output)</span><br><span class="line"><span class="comment"># output =  [9997297986272510947766344959498975323136012075787120721424325775003840341552673589487134830298427997676238039214108, 4943092972488023184271739094993470430272327679424224016751930100362045115374960494124801675393555642497051610643836, 6774612894247319645272578624765063875876643849415903973872536662648051668240882405640569448229188596797636795502471, 9334780454901460926052785252362305555845335155501888087843525321238695716687151256717815518958670595053951084051571, 2615136943375677027346821049033296095071476608523371102901038444464314877549948107134114941301290458464611872942706, 11755491858586722647182265446253701221615594136571038555321378377363341368427070357031882725576677912630050307145062, 7752070270905673490804344757589080653234375679657568428025599872155387643476306575613147681330227562712490805492345, 8402957532602451691327737154745340793606649602871190615837661809359377788072256203797817090151599031273142680590748, 2802440081918604590502596146113670094262600952020687184659605307695151120589816943051322503094363578916773414004662, 5627226318035765837286789021891141596394835871645925685252241680021740265826179768429792645576780380635014113687982]</span></span><br></pre></td></tr></table></figure>
<p>只给出了生成的伪随机数，根据法4求出模数m<img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128013247504.png" alt="image-20210128013247504"></p>
<p>再求出a,b,此时方法同例题4.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd,invert</span><br><span class="line"></span><br><span class="line">s =  [<span class="number">9997297986272510947766344959498975323136012075787120721424325775003840341552673589487134830298427997676238039214108</span>, <span class="number">4943092972488023184271739094993470430272327679424224016751930100362045115374960494124801675393555642497051610643836</span>, <span class="number">6774612894247319645272578624765063875876643849415903973872536662648051668240882405640569448229188596797636795502471</span>, <span class="number">9334780454901460926052785252362305555845335155501888087843525321238695716687151256717815518958670595053951084051571</span>, <span class="number">2615136943375677027346821049033296095071476608523371102901038444464314877549948107134114941301290458464611872942706</span>, <span class="number">11755491858586722647182265446253701221615594136571038555321378377363341368427070357031882725576677912630050307145062</span>, <span class="number">7752070270905673490804344757589080653234375679657568428025599872155387643476306575613147681330227562712490805492345</span>, <span class="number">8402957532602451691327737154745340793606649602871190615837661809359377788072256203797817090151599031273142680590748</span>, <span class="number">2802440081918604590502596146113670094262600952020687184659605307695151120589816943051322503094363578916773414004662</span>, <span class="number">5627226318035765837286789021891141596394835871645925685252241680021740265826179768429792645576780380635014113687982</span>]</span><br><span class="line">t = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    t.append(s[i]-s[i-<span class="number">1</span>])</span><br><span class="line">all_n = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    all_n.append(gcd((t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>]-t[i]*t[i]), (t[i+<span class="number">2</span>]*t[i]-t[i+<span class="number">1</span>]*t[i+<span class="number">1</span>])))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> all_n:</span><br><span class="line">    n=<span class="built_in">abs</span>(n)</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    a=(s[<span class="number">2</span>]-s[<span class="number">1</span>])*invert((s[<span class="number">1</span>]-s[<span class="number">0</span>]),n)%n</span><br><span class="line">    ani=invert(a,n)</span><br><span class="line">    b=(s[<span class="number">1</span>]-a*s[<span class="number">0</span>])%n</span><br><span class="line">    seed = (ani*(s[<span class="number">0</span>]-b))%n</span><br><span class="line">    plaintext=seed</span><br><span class="line">    print(long_to_bytes(plaintext))</span><br></pre></td></tr></table></figure>
<h4 id="6-华为AI冬令营一道类似题"><a href="#6-华为AI冬令营一道类似题" class="headerlink" title="6.华为AI冬令营一道类似题"></a>6.华为AI冬令营一道类似题</h4><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;DASCTF&#123;********************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span>(<span class="params">seed,params</span>):</span></span><br><span class="line">    (m,c,n)=params</span><br><span class="line">    s = seed % n</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = (m * s + c) % n</span><br><span class="line">        <span class="keyword">yield</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">seed = getPrime(<span class="number">128</span>)</span><br><span class="line">m = getPrime(<span class="number">128</span>)</span><br><span class="line">c = getPrime(<span class="number">128</span>)</span><br><span class="line">n = getPrime(<span class="number">129</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_stream = lcg(seed,(m,c,n))</span><br><span class="line">num=[]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">	num.append(<span class="built_in">next</span>(key_stream))</span><br><span class="line"></span><br><span class="line">secret =  <span class="built_in">next</span>(key_stream)</span><br><span class="line"></span><br><span class="line">e = nextprime(secret)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">r = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">flag ^= flag &gt;&gt; <span class="number">10</span></span><br><span class="line">print(p)</span><br><span class="line">print(p*q*r)</span><br><span class="line">print(<span class="built_in">pow</span>(flag,e,p*q*r))</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">num = [<span class="number">58605992502479537155943965904595921273</span>, <span class="number">525605798656979919420608964379033982804</span>, <span class="number">607738431135489138748992347244318940466</span>, <span class="number">631747898536603358381419028993140907216</span>, <span class="number">13450658701001781564543219325486287717</span>, <span class="number">407826262741495712819054543462943222370</span>]</span><br><span class="line">p = <span class="number">138092450043978032187397495330379791355629274237204650898232878263413301988536751004632087169676028049236253598677819980191406826529664613957150122788435561338344715937422320958238628877093605040078776555586363593650646481242888908171897232624141894446324625781720275455534977357099473212936612966142541689717</span></span><br><span class="line">newN = <span class="number">3373500409784821814490131118443028295231446638918191872866826078664586857545499510115664725311697632345156866795088640886074708893049896293408277232121045205172588091316164743124173177747110069553394872128870505076277498830601152723565030932360665298864122468812389923295873644041292977470736981439616767671752225297169001703767163460419431015014012924743881828753765788455996503018031103917461875346904941302752301152097427368052588291798732671143344833211267818507324812463058368199324367285019651028003000765054679485233317767201747568717493732406861626561470103436488978595267326521876995116542475030869904228103019888619123275263009931569375612626796485751453790231029224398879558668919940829341599982045260085645733137064910612640851525128951165660322666651603943749615559507563880191545144231282875004494643666234781231448702811026047613232622993307630737999918058511598922102840862761604680588858313364100914751476403</span></span><br><span class="line">c = <span class="number">40522976224675404992818282038409183193065303107530049168092540620105120083552580372904554927069109321998620410524986748598618388761467715127564839742806614159382512978830563949967053562802375030363283879451081474764301602860367140250483857874335594802704634427276762179861996608105102610424633434334897307449739846880323406404392707133580686043181007091235341464802410874449708870610192494627811013526751435468963111672237058189288520084494533786573065843704621915085789731723587760910378534773137633519620193203450046994466154848079413319979993890764583887936777316159487010002407093187269512820453207591173395762513970799972839858119501585885277954258269483363133460240339866272358522431904252286259542327658731232568465990008278265227086114042064326334937705758042097987623388556184022737180944807660792992413039097516526454455063218161704505837882378018400687043158628503465274374703624257222504948612055237771581019005</span></span><br></pre></td></tr></table></figure>


<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a,b</span>):</span> </span><br><span class="line">    <span class="keyword">if</span>(b == <span class="number">0</span>): </span><br><span class="line">        <span class="keyword">return</span> a </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> gcd(b,a % b) </span><br><span class="line"></span><br><span class="line">s =  [<span class="number">58605992502479537155943965904595921273</span>, <span class="number">525605798656979919420608964379033982804</span>, <span class="number">607738431135489138748992347244318940466</span>, <span class="number">631747898536603358381419028993140907216</span>, <span class="number">13450658701001781564543219325486287717</span>, <span class="number">407826262741495712819054543462943222370</span>]</span><br><span class="line">t = []</span><br><span class="line">all_n = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    t.append(s[i] - s[i - <span class="number">1</span>]) </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    all_n.append(gcd((t[i + <span class="number">1</span>] * t[i - <span class="number">1</span>] - t[i] * t[i]), (t[i + <span class="number">2</span>] * t[i] - t[i + <span class="number">1</span>] * t[i + <span class="number">1</span>]))) </span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n, s=<span class="number">1</span>, t=<span class="number">0</span>, N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t % N <span class="keyword">or</span> MMI(n, A % n, t, s - A // n * t, N <span class="keyword">or</span> n), -<span class="number">1</span>)[n &lt; <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> all_n:</span><br><span class="line">    n = <span class="built_in">abs</span>(n)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    m = (s[<span class="number">2</span>] - s[<span class="number">1</span>]) * MMI((s[<span class="number">1</span>] - s[<span class="number">0</span>]), n) % n</span><br><span class="line">    ani = MMI(m,n)</span><br><span class="line">    c = (s[<span class="number">1</span>] - m * s[<span class="number">0</span>]) % n</span><br><span class="line">    seed = (ani * (s[<span class="number">0</span>] - c)) % n</span><br><span class="line">    print(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line">    print(<span class="string">&quot;m = &quot;</span>,m)</span><br><span class="line">    print(<span class="string">&quot;c = &quot;</span>,c)</span><br><span class="line">    print(<span class="string">&quot;seed = &quot;</span>,seed)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># n =  658483278832814360413959491304994965751</span></span><br><span class="line"><span class="comment"># m =  304895213771629215412875483024241040557</span></span><br><span class="line"><span class="comment"># c =  332633353219222389093389121471714482887</span></span><br><span class="line"><span class="comment"># seed =  233122372118782757817692638408531340431</span></span><br></pre></td></tr></table></figure>
<p>接下来就是简单的rsa题分析了。</p>
<p>根据e = nextprime(secret)，且secret =  next(key_stream)可知，e为lcg的第7个数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n =  <span class="number">658483278832814360413959491304994965751</span></span><br><span class="line">m =  <span class="number">304895213771629215412875483024241040557</span></span><br><span class="line">c =  <span class="number">332633353219222389093389121471714482887</span></span><br><span class="line">seed =  <span class="number">233122372118782757817692638408531340431</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span>(<span class="params">seed,params</span>):</span></span><br><span class="line">    (m,c,n)=params</span><br><span class="line">    s = seed % n</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = (m * s + c) % n</span><br><span class="line">        <span class="keyword">yield</span> s</span><br><span class="line"></span><br><span class="line">key_stream = lcg(seed,(m,c,n))</span><br><span class="line">num=[]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">	num.append(<span class="built_in">next</span>(key_stream))</span><br><span class="line"></span><br><span class="line">secret =  <span class="built_in">next</span>(key_stream)</span><br><span class="line">e = nextprime(secret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># e = 176683449265430137948016253982177600477</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解密过程如下（手写。。。不会用电脑写公式。。。。。下次学。。。。。。。</p>
<p><img src="https://13-1301107080.cos.ap-guangzhou.myqcloud.com/image-20210128113836571.png" alt="image-20210128113836571"></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = <span class="number">138092450043978032187397495330379791355629274237204650898232878263413301988536751004632087169676028049236253598677819980191406826529664613957150122788435561338344715937422320958238628877093605040078776555586363593650646481242888908171897232624141894446324625781720275455534977357099473212936612966142541689717</span></span><br><span class="line">c = <span class="number">40522976224675404992818282038409183193065303107530049168092540620105120083552580372904554927069109321998620410524986748598618388761467715127564839742806614159382512978830563949967053562802375030363283879451081474764301602860367140250483857874335594802704634427276762179861996608105102610424633434334897307449739846880323406404392707133580686043181007091235341464802410874449708870610192494627811013526751435468963111672237058189288520084494533786573065843704621915085789731723587760910378534773137633519620193203450046994466154848079413319979993890764583887936777316159487010002407093187269512820453207591173395762513970799972839858119501585885277954258269483363133460240339866272358522431904252286259542327658731232568465990008278265227086114042064326334937705758042097987623388556184022737180944807660792992413039097516526454455063218161704505837882378018400687043158628503465274374703624257222504948612055237771581019005</span></span><br><span class="line">phi = p - <span class="number">1</span></span><br><span class="line">e = <span class="number">176683449265430137948016253982177600477</span></span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#m=569987504250336203008383799281952855095298052417061158522700484233183317916824291767569080757872</span></span><br></pre></td></tr></table></figure>
<p>又因为flag=flag&gt;&gt;10.</p>
<p>m的前10位其实是明文的前10位，而m的<code>10-20</code>位则是明文的前<code>1</code>0位和<code>10-20</code>位的异或，由于我们知道明文的前10位，因此很容易恢复明文的10-20`位以此类推，可以恢复所有明文的比特位。下面的exp是改了一道题的exp。= =站在巨人身上学crypto…….(逃)</p>
<p>exp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># from Crypto.Util.number import *</span><br><span class="line"> #enc&#x3D;569987504250336203008383799281952855095298052417061158522700484233183317916824291767569080757872</span><br><span class="line"># shift &#x3D; 10</span><br><span class="line"># def inverse_right(res, shift, bits&#x3D;32):</span><br><span class="line">#     tmp &#x3D; res</span><br><span class="line">#     for i in range(bits &#x2F;&#x2F; shift):</span><br><span class="line">#         tmp &#x3D; res ^ tmp &gt;&gt; shift</span><br><span class="line">#     return tmp</span><br><span class="line"># flag &#x3D; inverse_right(enc,shift,enc.bit_length())</span><br><span class="line"># print(bytes.fromhex(hex(flag)[2:].strip(&quot;0xL&quot;)))</span><br><span class="line"></span><br><span class="line">#DASCTF&#123;b19998fb5acd197e441029b37bc246d7&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p>《图解密码学》12章 –[日]结城浩著</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/superprintf/article/details/108964563">https://blog.csdn.net/superprintf/article/details/108964563</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lion19930924/article/details/61926019">https://blog.csdn.net/lion19930924/article/details/61926019</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014634338/article/details/40210435">https://blog.csdn.net/u014634338/article/details/40210435</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2021/02/15/hello-world/" class="prev">PREV</a></div><div class="copyright"><p>© 2015 - 2021 <a href="http://example.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>